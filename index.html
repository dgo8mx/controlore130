<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema SEMARNAT Durango</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .area-card { transition: all 0.3s ease; }
        .area-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .area-card.disabled { opacity: 0.4; cursor: not-allowed; }
        .area-card.active { 
            border: 3px solid #fbbf24; 
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
            animation: pulse 2s infinite;
        }
        .area-card.admin-access {
            border: 3px solid #10b981;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); }
            50% { box-shadow: 0 0 30px rgba(251, 191, 36, 0.8); }
        }
    </style>
</head>
<body class="bg-slate-50">
    
    <header class="bg-gradient-to-r from-emerald-700 to-emerald-800 text-white p-6 shadow-xl">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <i class="fas fa-tree text-4xl"></i>
                <div>
                    <h1 class="text-3xl font-bold">Sistema de Control de Determinantes</h1>
                    <p class="text-emerald-200 mt-1">SEMARNAT Durango - Enero 2026</p>
                </div>
            </div>
            <div class="text-right">
                <p class="text-emerald-200 text-sm">Usuario</p>
                <p class="font-bold text-lg" id="userName">...</p>
                <p class="text-xs text-emerald-300" id="userArea"></p>
                <div class="mt-2 flex gap-2 justify-end">
                    <button onClick="goToAdmin()" id="adminButton" class="hidden bg-purple-500 hover:bg-purple-600 px-4 py-1 rounded text-sm">
                        <i class="fas fa-cog mr-1"></i> Panel Admin
                    </button>
                    <button onClick="logout()" class="bg-red-500 hover:bg-red-600 px-4 py-1 rounded text-sm">
                        <i class="fas fa-sign-out-alt mr-1"></i> Salir
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-6 py-8">
        
        <div class="bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold mb-2">
                <i class="fas fa-hand-sparkles mr-2"></i> Bienvenido/a
            </h2>
            <p id="welcomeText">Cargando información...</p>
        </div>

        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">
                <i class="fas fa-map-marked-alt text-emerald-600 mr-2"></i> Áreas Sustantivas de Trabajo
            </h2>
            <div id="areasContainer" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
        </div>

        <div class="bg-yellow-50 border-2 border-yellow-400 rounded-xl p-6 mb-8">
            <h3 class="text-lg font-bold text-yellow-800 mb-2">
                <i class="fas fa-info-circle mr-2"></i> Información
            </h3>
            <ul class="text-yellow-700 space-y-2 text-sm" id="infoList">
                <li><i class="fas fa-check mr-2"></i> Solo puede acceder al área asignada</li>
                <li><i class="fas fa-check mr-2"></i> Su área está resaltada con borde dorado</li>
                <li><i class="fas fa-clock mr-2"></i> Sesión válida por 8 horas</li>
            </ul>
        </div>

    </main>

<!-- Contenedor para iframe debajo del header -->
<div id="iframeContainer" class="hidden container mx-auto px-6 pb-8">
    <div class="bg-white rounded-xl shadow-xl overflow-hidden">
        <div class="bg-emerald-600 text-white p-4 flex justify-between items-center">
            <h3 class="text-xl font-bold" id="iframeTitle">
                <i class="fas fa-folder-open mr-2"></i> Área cargada
            </h3>
            <button onclick="closeIframe()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg transition">
                <i class="fas fa-times mr-2"></i> Cerrar
            </button>
        </div>
        <iframe id="areaFrame" class="w-full bg-white" style="height: 75vh; border: none;"></iframe>
    </div>
</div>

        <!-- APARTADO: PROCEDIMIENTO INTERNO (ANTES DE GUÍA DE USO) -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">
                <i class="fas fa-file-signature text-purple-600 mr-2"></i> PROCEDIMIENTO INTERNO: DETERMINANTES PARA OFICIOS
            </h2>

            <!-- Formato del Determinante -->
            <div class="formato-determinante">
                <h3 class="text-xl font-bold text-slate-700 mb-4 text-center">
                    <i class="fas fa-hashtag text-emerald-600 mr-2"></i> Formato del Determinante
                </h3>
                
                <div class="formato-box mb-6">
                    OR-130/XX&nbsp;&nbsp;&nbsp;&nbsp;/####/2026
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="descripcion-item">
                        <p class="text-xs font-bold text-slate-500 mb-1">OR-130</p>
                        <p class="text-sm text-slate-700">Referencia a la Oficina de Representación en el Estado de Durango</p>
                    </div>
                    <div class="descripcion-item">
                        <p class="text-xs font-bold text-slate-500 mb-1">XX</p>
                        <p class="text-sm text-slate-700">Área sustantiva (Ver tabla de áreas)</p>
                    </div>
                    <div class="descripcion-item">
                        <p class="text-xs font-bold text-slate-500 mb-1">####</p>
                        <p class="text-sm text-slate-700">Número consecutivo a cuatro dígitos</p>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-lg border-2 border-slate-200">
                    <h4 class="font-bold text-slate-700 mb-3">
                        <i class="fas fa-info-circle text-blue-600 mr-2"></i> Descripción de Elementos
                    </h4>
                    <ul class="space-y-2 text-sm text-slate-600">
                        <li><strong>OR-130:</strong> Referencia a la Oficina de Representación en el Estado de Durango</li>
                        <li><strong>XX:</strong> Área sustantiva</li>
                        <li><strong>2026:</strong> Año de expedición a cuatro dígitos</li>
                        <li><strong>-:</strong> Espaciador</li>
                        <li><strong>/:</strong> Separador</li>
                    </ul>
                </div>
            </div>

            <!-- Tabla de Áreas y Responsables -->
            <div class="mt-8">
                <h3 class="text-xl font-bold text-slate-700 mb-4">
                    <i class="fas fa-users text-blue-600 mr-2"></i> Catálogo de Áreas y Responsables
                </h3>

                <div class="overflow-x-auto">
                    <table class="w-full border-collapse bg-white shadow-lg rounded-lg overflow-hidden">
                        <thead class="bg-gradient-to-r from-emerald-600 to-emerald-700 text-white">
                            <tr>
                                <th class="p-4 text-left font-bold text-sm">No.</th>
                                <th class="p-4 text-center font-bold text-sm">Clave</th>
                                <th class="p-4 text-left font-bold text-sm">Nombre del Área</th>
                                <th class="p-4 text-left font-bold text-sm">Responsable</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-200">
                            <tr class="hover:bg-emerald-50 transition">
                                <td class="p-4 text-slate-600 font-semibold">1</td>
                                <td class="p-4 text-center">
                                    <span class="bg-emerald-100 text-emerald-800 px-3 py-1 rounded-full font-bold text-sm">UJ</span>
                                </td>
                                <td class="p-4 text-slate-700 font-medium">Unidad Jurídica</td>
                                <td class="p-4 text-slate-600">Francisco Javier Guardado Marín</td>
                            </tr>
                            <tr class="hover:bg-purple-50 transition">
                                <td class="p-4 text-slate-600 font-semibold">2</td>
                                <td class="p-4 text-center">
                                    <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full font-bold text-sm">CC</span>
                                </td>
                                <td class="p-4 text-slate-700 font-medium">Departamento de Contacto Ciudadano</td>
                                <td class="p-4 text-slate-600">María de Lourdes Michel García</td>
                            </tr>
                            <tr class="hover:bg-indigo-50 transition">
                                <td class="p-4 text-slate-600 font-semibold">3</td>
                                <td class="p-4 text-center">
                                    <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full font-bold text-sm">DA</span>
                                </td>
                                <td class="p-4 text-slate-700 font-medium">Departamento de Administración</td>
                                <td class="p-4 text-slate-600">Fidel Soto Montoya</td>
                            </tr>
                            <tr class="hover:bg-teal-50 transition">
                                <td class="p-4 text-slate-600 font-semibold">4</td>
                                <td class="p-4 text-center">
                                    <span class="bg-teal-100 text-teal-800 px-3 py-1 rounded-full font-bold text-sm">GA</span>
                                </td>
                                <td class="p-4 text-slate-700 font-medium">Unidad de Gestión Ambiental</td>
                                <td class="p-4 text-slate-600">Trinidad Valenzuela Hermosillo</td>
                            </tr>
                            <tr class="hover:bg-blue-50 transition">
                                <td class="p-4 text-slate-600 font-semibold">5</td>
                                <td class="p-4 text-center">
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-bold text-sm">AR</span>
                                </td>
                                <td class="p-4 text-slate-700 font-medium">Unidad de Aprovechamiento y Restauración Forestal</td>
                                <td class="p-4 text-slate-600">Rubén Lozano Orosco</td>
                            </tr>
                            <tr class="hover:bg-cyan-50 transition">
                                <td class="p-4 text-slate-600 font-semibold">6</td>
                                <td class="p-4 text-center">
                                    <span class="bg-cyan-100 text-cyan-800 px-3 py-1 rounded-full font-bold text-sm">IA</span>
                                </td>
                                <td class="p-4 text-slate-700 font-medium">Departamento de Impacto y Riesgo Ambiental</td>
                                <td class="p-4 text-slate-600">Elías Chacón de la Cruz</td>
                            </tr>
                            <tr class="hover:bg-pink-50 transition">
                                <td class="p-4 text-slate-600 font-semibold">7</td>
                                <td class="p-4 text-center">
                                    <span class="bg-pink-100 text-pink-800 px-3 py-1 rounded-full font-bold text-sm">CU</span>
                                </td>
                                <td class="p-4 text-slate-700 font-medium">Departamento de Servicios Forestales y de Suelos</td>
                                <td class="p-4 text-slate-600">Raúl Quiroga Gómez</td>
                            </tr>
                            <tr class="hover:bg-orange-50 transition">
                                <td class="p-4 text-slate-600 font-semibold">8</td>
                                <td class="p-4 text-center">
                                    <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full font-bold text-sm">SP</span>
                                </td>
                                <td class="p-4 text-slate-700 font-medium">Centro de Atención Regional Santiago Papasquiaro</td>
                                <td class="p-4 text-slate-600">BRENDA OLAINE CORRAL ZEPEDA</td>
                            </tr>
                            <tr class="hover:bg-yellow-50 transition">
                                <td class="p-4 text-slate-600 font-semibold">9</td>
                                <td class="p-4 text-center">
                                    <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full font-bold text-sm">ES</span>
                                </td>
                                <td class="p-4 text-slate-700 font-medium">Centro de Atención Regional El Salto</td>
                                <td class="p-4 text-slate-600">María Elena Díaz Mancinas</td>
                            </tr>
                            <tr class="hover:bg-emerald-50 transition">
                                <td class="p-4 text-slate-600 font-semibold">10</td>
                                <td class="p-4 text-center">
                                    <span class="bg-emerald-100 text-emerald-800 px-3 py-1 rounded-full font-bold text-sm">VO</span>
                                </td>
                                <td class="p-4 text-slate-700 font-medium">Centro de Atención Regional Villa Ocampo</td>
                                <td class="p-4 text-slate-600">Manuel Hernández Silerio</td>
                            </tr>
                            <tr class="hover:bg-red-50 transition">
                                <td class="p-4 text-slate-600 font-semibold">11</td>
                                <td class="p-4 text-center">
                                    <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full font-bold text-sm">DG</span>
                                </td>
                                <td class="p-4 text-slate-700 font-medium">Coordinación Documentación Forestal Durango</td>
                                <td class="p-4 text-slate-600">María Azucena Corral Valdez</td>
                            </tr>
                            <tr class="hover:bg-lime-50 transition">
                                <td class="p-4 text-slate-600 font-semibold">12</td>
                                <td class="p-4 text-center">
                                    <span class="bg-lime-100 text-lime-800 px-3 py-1 rounded-full font-bold text-sm">VS</span>
                                </td>
                                <td class="p-4 text-slate-700 font-medium">Enlace de Recursos Naturales y Vida Silvestre</td>
                                <td class="p-4 text-slate-600">Manuel Alfredo Sariñana Pérez</td>
                            </tr>
							
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Ejemplos de Determinantes -->
            <div class="mt-8 bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border-2 border-blue-200">
                <h3 class="text-xl font-bold text-slate-700 mb-4">
                    <i class="fas fa-lightbulb text-yellow-500 mr-2"></i> Ejemplos de Determinantes
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-xs text-slate-500 font-bold mb-2">Unidad Jurídica</p>
                        <p class="text-lg font-mono font-bold text-emerald-700">OR-130/UJ/0001/2026</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-xs text-slate-500 font-bold mb-2">Villa Ocampo</p>
                        <p class="text-lg font-mono font-bold text-emerald-700">OR-130/VO/0045/2026</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-xs text-slate-500 font-bold mb-2">Impacto Ambiental</p>
                        <p class="text-lg font-mono font-bold text-emerald-700">OR-130/IA/0123/2026</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-xs text-slate-500 font-bold mb-2">Gestión Ambiental</p>
                        <p class="text-lg font-mono font-bold text-emerald-700">OR-130/GA/0089/2026</p>
                    </div>
                </div>
            </div>

            <!-- Nota Importante -->
            <div class="mt-6 bg-amber-50 border-l-4 border-amber-500 p-4 rounded">
                <div class="flex items-start gap-3">
                    <i class="fas fa-exclamation-triangle text-amber-600 text-xl mt-1"></i>
                    <div>
                        <h4 class="font-bold text-amber-900 mb-1">Nota Importante</h4>
                        <p class="text-sm text-amber-800">
                            El número consecutivo se genera automáticamente por área y año. Cada área mantiene su propia numeración independiente. 
                            El sistema garantiza que no se repitan números dentro del mismo año y área.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- FIN APARTADO PROCEDIMIENTO INTERNO -->

        <!-- INICIO: GUÍA DE USO DEL SISTEMA -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">
                <i class="fas fa-book text-blue-600 mr-2"></i> Guía de Uso del Sistema
            </h2>
            
            <div class="space-y-6">
                <div class="feature-card bg-slate-50 p-6 rounded-xl">
                    <h3 class="text-lg font-bold text-slate-800 mb-3">
                        <i class="fas fa-rocket text-emerald-600 mr-2"></i> 1. Inicio de Sesión
                    </h3>
                    <ul class="space-y-2 text-slate-600">
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-emerald-600 mt-1"></i>
                            <span>Al abrir cualquier área, el sistema automáticamente carga todos los datos desde la base concentradora</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-emerald-600 mt-1"></i>
                            <span>Los registros sincronizados aparecen con fondo azul y candado, no pueden editarse</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-emerald-600 mt-1"></i>
                            <span>Los registros locales pendientes aparecen con fondo amarillo y pueden editarse</span>
                        </li>
                    </ul>
                </div>

                <div class="feature-card bg-slate-50 p-6 rounded-xl">
                    <h3 class="text-lg font-bold text-slate-800 mb-3">
                        <i class="fas fa-plus-circle text-blue-600 mr-2"></i> 2. Captura de Determinantes
                    </h3>
                    <ul class="space-y-2 text-slate-600">
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-blue-600 mt-1"></i>
                            <span>Primero configure el catálogo de trámites en el panel lateral derecho</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-blue-600 mt-1"></i>
                            <span>Seleccione el trámite, ingrese bitácora (opcional) y asunto del determinante</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-blue-600 mt-1"></i>
                            <span>Los registros se guardan localmente y generan respaldo automático cada minuto</span>
                        </li>
                    </ul>
                </div>

                <div class="feature-card bg-slate-50 p-6 rounded-xl">
                    <h3 class="text-lg font-bold text-slate-800 mb-3">
                        <i class="fas fa-cloud-upload-alt text-purple-600 mr-2"></i> 3. Sincronización con la Nube
                    </h3>
                    <ul class="space-y-2 text-slate-600">
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-purple-600 mt-1"></i>
                            <span>Presione el botón "SINCRONIZAR" para enviar registros pendientes a la base concentradora</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-purple-600 mt-1"></i>
                            <span>Los registros sincronizados quedan bloqueados y no pueden editarse ni eliminarse</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-purple-600 mt-1"></i>
                            <span>El catálogo de trámites también se sincroniza automáticamente</span>
                        </li>
                    </ul>
                </div>

                <div class="feature-card bg-slate-50 p-6 rounded-xl">
                    <h3 class="text-lg font-bold text-slate-800 mb-3">
                        <i class="fas fa-shield-alt text-red-600 mr-2"></i> 4. Protección de Datos
                    </h3>
                    <ul class="space-y-2 text-slate-600">
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-red-600 mt-1"></i>
                            <span>Sistema de respaldo automático local genera archivos JSON cada minuto</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-red-600 mt-1"></i>
                            <span>Los registros sincronizados están protegidos contra edición y eliminación</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-red-600 mt-1"></i>
                            <span>Use el botón "EXPORTAR" para generar respaldos CSV manuales</span>
                        </li>
                    </ul>
                </div>

                <div class="feature-card bg-slate-50 p-6 rounded-xl">
                    <h3 class="text-lg font-bold text-slate-800 mb-3">
                        <i class="fas fa-sync-alt text-indigo-600 mr-2"></i> 5. Actualización de Datos
                    </h3>
                    <ul class="space-y-2 text-slate-600">
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-indigo-600 mt-1"></i>
                            <span>Presione "ACTUALIZAR" para traer los últimos datos de la base concentradora</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-indigo-600 mt-1"></i>
                            <span>El sistema fusiona datos locales pendientes con datos de la nube</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="fas fa-check text-indigo-600 mt-1"></i>
                            <span>Use "PROBAR" para verificar la conexión con la base de datos</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- FIN: GUÍA DE USO DEL SISTEMA -->

        <div class="bg-gradient-to-r from-slate-700 to-slate-800 text-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold mb-4">
                <i class="fas fa-info-circle mr-2"></i> Información Técnica
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-bold text-lg mb-3 text-emerald-400">Base de Datos</h3>
                    <ul class="space-y-2 text-sm text-slate-300">
                        <li><i class="fas fa-database mr-2"></i> Tabla: registro_oficios</li>
                        <li><i class="fas fa-list mr-2"></i> Tabla: catalogo_tramites</li>
                        <li><i class="fas fa-filter mr-2"></i> Filtro por área: area_siglas</li>
                        <li><i class="fas fa-clock mr-2"></i> Ordenamiento: fecha descendente</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold text-lg mb-3 text-blue-400">Almacenamiento Local</h3>
                    <ul class="space-y-2 text-sm text-slate-300">
                        <li><i class="fas fa-save mr-2"></i> localStorage para cada área</li>
                        <li><i class="fas fa-file-code mr-2"></i> Formato: JSON estructurado</li>
                        <li><i class="fas fa-shield-alt mr-2"></i> Respaldos automáticos cada 60s</li>
                        <li><i class="fas fa-lock mr-2"></i> Protección de registros sincronizados</li>
                    </ul>
                </div>
            </div>
  

    <footer class="bg-slate-800 text-white py-6 mt-12">
        <div class="container mx-auto px-6 text-center">
            <p class="text-slate-400">Sistema desarrollado para SEMARNAT Durango</p>
			<p class="text-slate-200">By IA-Trinidad Valenzuela Hermosillo</p>
            <p class="text-slate-500 text-sm mt-2">Versión 3.0 - Enero 2026</p>
        </div>
    </footer>

    <script>
        const CONFIG = {
            SUPABASE_URL: 'https://rnwksmgwmnjatrgezaaa.supabase.co',
            SUPABASE_KEY: 'sb_publishable_TQIHyFu5lTwLl6GvF2c7zw_2q4YeSls'
        };
        
        let clienteSupabase;
        let sesionActual;

        const areas = [
            { codigo: 'UJ', nombre: 'Unidad Jurídica', responsable: 'Francisco Javier Guardado Marín', color: 'from-emerald-500 to-emerald-600', archivo: 'AREA_UJ.html' },
            { codigo: 'CC', nombre: 'Departamento de Contacto Ciudadano', responsable: 'María de Lourdes Michel García', color: 'from-purple-500 to-purple-600', archivo: 'AREA_CC.html' },
            { codigo: 'DA', nombre: 'Departamento de Administración', responsable: 'Fidel Soto Montoya', color: 'from-indigo-500 to-indigo-600', archivo: 'AREA_DA.html' },
            { codigo: 'GA', nombre: 'Unidad de Gestión Ambiental', responsable: 'Trinidad Valenzuela Hermosillo', color: 'from-teal-500 to-teal-600', archivo: 'AREA_GA.html' },
            { codigo: 'AR', nombre: 'Unidad de Aprovechamiento y Restauración Forestal', responsable: 'Rubén Lozano Orosco', color: 'from-blue-500 to-blue-600', archivo: 'AREA_AR.html' },
            { codigo: 'IA', nombre: 'Departamento de Impacto y Riesgo Ambiental', responsable: 'Elías Chacón de la Cruz', color: 'from-cyan-500 to-cyan-600', archivo: 'AREA_IA.html' },
            { codigo: 'CU', nombre: 'Departamento de Servicios Forestales y de Suelos', responsable: 'Raúl Quiroga Gómez', color: 'from-pink-500 to-pink-600', archivo: 'AREA_CU.html' },
            { codigo: 'ST', nombre: 'Centro de Atención Regional Santiago Papasquiaro', responsable: 'BRENDA OLAINE CORRAL ZEPEDA', color: 'from-orange-500 to-orange-600', archivo: 'AREA_ST.html' },
            { codigo: 'ES', nombre: 'Centro de Atención Regional El Salto', responsable: 'María Elena Díaz Mancinas', color: 'from-yellow-500 to-yellow-600', archivo: 'AREA_ES.html' },
            { codigo: 'VO', nombre: 'Centro de Atención Regional Villa Ocampo', responsable: 'Manuel Hernández Silerio', color: 'from-green-500 to-green-600', archivo: 'AREA_VO.html' },
            { codigo: 'DG', nombre: 'Coordinación Documentación Forestal Durango', responsable: 'María Azucena Corral Valdez', color: 'from-red-500 to-red-600', archivo: 'AREA_DG.html' },
            { codigo: 'VS', nombre: 'Enlace de Recursos Naturales y Vida Silvestre', responsable: 'Manuel Alfredo Sariñana Pérez', color: 'from-lime-500 to-lime-600', archivo: 'AREA_VS.html' },
			{ codigo: 'SF', nombre: 'Sanidad Forestal', responsable: 'JUAN DANIEL GALVÁN MELÉNDEZ', color: 'from-lime-500 to-lime-600', archivo: 'AREA_SF.html' }
		
        ];

        function checkSession() {
            const sessionData = localStorage.getItem('sesion_semarnat');
            if (!sessionData) {
                window.location.href = 'login.html';
                return false;
            }

            try {
                sesionActual = JSON.parse(sessionData);
                const lastAccess = new Date(localStorage.getItem('ultimo_acceso'));
                const hours = (new Date() - lastAccess) / (1000 * 60 * 60);

                if (hours > 8) {
                    alert('Su sesión ha expirado');
                    logout();
                    return false;
                }

                localStorage.setItem('ultimo_acceso', new Date().toISOString());

                // CAMBIO: Solo root va a admin.html automáticamente
                if (sesionActual.username === 'root') {
                    window.location.href = 'admin.html';
                    return false;
                }

                return true;
            } catch {
                logout();
                return false;
            }
        }

        function loadUserInfo() {
            document.getElementById('userName').textContent = sesionActual.nombre;
            
            // CAMBIO: Verificar si es admin
            const esAdmin = sesionActual.username === 'admin';
            
            // Mostrar botón de admin si es admin (pero no root)
            if (esAdmin) {
                document.getElementById('adminButton').classList.remove('hidden');
            }
            
            if (esAdmin) {
                // Admin tiene acceso a todas las áreas
                document.getElementById('userArea').textContent = 'Acceso: TODAS LAS ÁREAS';
                document.getElementById('welcomeText').textContent = 
                    'Como administrador, tiene acceso completo a todas las áreas del sistema. Las áreas están resaltadas en verde.';
                
                // Cambiar información en el panel amarillo
                document.getElementById('infoList').innerHTML = `
                    <li><i class="fas fa-crown mr-2"></i> Acceso completo como administrador</li>
                    <li><i class="fas fa-check mr-2"></i> Puede acceder a todas las áreas (borde verde)</li>
                    <li><i class="fas fa-cog mr-2"></i> Panel de administración disponible</li>
                    <li><i class="fas fa-clock mr-2"></i> Sesión válida por 8 horas</li>
                `;
            } else {
                // Usuario normal
                const areaInfo = areas.find(a => a.codigo === sesionActual.area);
                if (areaInfo) {
                    document.getElementById('userArea').textContent = `Área: ${areaInfo.codigo} - ${areaInfo.responsable}`;
                    document.getElementById('welcomeText').textContent = 
                        `Tiene acceso al área: ${areaInfo.codigo} - ${areaInfo.nombre}. Haga clic en el área resaltada para comenzar.`;
                } else {
                    document.getElementById('userArea').textContent = 'Sin área asignada';
                    document.getElementById('welcomeText').textContent = 'No tiene área asignada. Contacte al administrador.';
                }
            }
        }

        function showAreas() {
            const container = document.getElementById('areasContainer');
            container.innerHTML = '';

            // CAMBIO: Verificar si es admin
            const esAdmin = sesionActual.username === 'admin';

            areas.forEach(area => {
                // Usuario admin tiene acceso a todas las áreas
                // Usuario normal solo a su área asignada
                const hasAccess = esAdmin || area.codigo === sesionActual.area;
                
                const card = document.createElement('div');
                
                // Cambiar estilo para admin (verde) vs usuario normal (dorado)
                let cardClass = `area-card bg-gradient-to-br ${area.color} text-white p-6 rounded-xl shadow-lg cursor-pointer `;
                if (hasAccess) {
                    cardClass += esAdmin ? 'admin-access' : 'active';
                } else {
                    cardClass += 'disabled';
                }
                
                card.className = cardClass;
                
                card.innerHTML = `
                    <div class="text-center">
                        <div class="bg-white bg-opacity-20 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3">
                            <span class="text-2xl font-bold">${area.codigo}</span>
                        </div>
                        <h3 class="font-bold text-lg mb-2">${area.nombre}</h3>
                        <p class="text-xs opacity-75 mb-2">${area.responsable}</p>
                        ${hasAccess ? 
                            `<p class="text-xs opacity-90"><i class="fas fa-${esAdmin ? 'crown' : 'unlock-alt'} mr-1"></i> Clic para abrir</p>` :
                            '<p class="text-xs opacity-50"><i class="fas fa-lock mr-1"></i> Acceso restringido</p>'
                        }
                    </div>
                `;
                
                if (hasAccess) {
                    card.onclick = () => openArea(area);
                }
                
                container.appendChild(card);
            });
        }

async function openArea(area) {
    console.log('Abriendo área:', area.codigo);
    
    if (clienteSupabase) {
        try {
            await clienteSupabase.from('auditoria_accesos').insert({
                username: sesionActual.username,
                tipo_evento: 'acceso_area',
                fecha_hora: new Date().toISOString(),
                exitoso: true,
                detalles: area.codigo
            });
        } catch (e) {
            console.log('Auditoría no disponible');
        }
    }
    
    // Ocultar el contenido principal
    document.querySelector('main').classList.add('hidden');
    
    // Mostrar iframe con el área
    document.getElementById('iframeTitle').innerHTML = 
        `<i class="fas fa-folder-open mr-2"></i> ${area.codigo} - ${area.nombre}`;
    document.getElementById('areaFrame').src = area.archivo;
    document.getElementById('iframeContainer').classList.remove('hidden');
    
    // Scroll al inicio
    window.scrollTo(0, 0);
}

        function goToAdmin() {
            window.location.href = 'admin.html';
        }

        function logout() {
            localStorage.removeItem('sesion_semarnat');
            localStorage.removeItem('ultimo_acceso');
            window.location.href = 'login.html';
        }

        setInterval(() => {
            const lastAccess = localStorage.getItem('ultimo_acceso');
            if (!lastAccess) return;
            
            const hours = (new Date() - new Date(lastAccess)) / (1000 * 60 * 60);
            if (hours > 8) {
                alert('Su sesión ha expirado');
                logout();
            }
        }, 5 * 60 * 1000);

		
function closeIframe() {
    const container = document.getElementById('iframeContainer');
    const frame = document.getElementById('areaFrame');
    const mainContent = document.querySelector('main');
    
    container.classList.add('hidden');
    frame.src = '';
    mainContent.classList.remove('hidden');
}

		
		
        window.onload = async () => {
            console.log('Iniciando dashboard...');
            
            if (!checkSession()) return;
            
            loadUserInfo();
            showAreas();
            
            try {
                if (window.supabase) {
                    clienteSupabase = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_KEY);
                    
                    await clienteSupabase.from('auditoria_accesos').insert({
                        username: sesionActual.username,
                        tipo_evento: 'acceso_dashboard',
                        fecha_hora: new Date().toISOString(),
                        exitoso: true,
                        detalles: sesionActual.area || 'ADMIN_ALL'
                    });
                }
            } catch (e) {
                console.log('Auditoría no disponible');
            }
            
            console.log('Dashboard listo');
        };
    </script>

</body>
</html>














